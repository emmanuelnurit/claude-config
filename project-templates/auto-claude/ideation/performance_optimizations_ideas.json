{
  "performance_optimizations": [
    {
      "id": "perf-001",
      "type": "performance_optimizations",
      "title": "Optimize Google Fonts loading - Replace render-blocking @import with preload",
      "description": "The Plus Jakarta Sans font is loaded via @import in CSS (app.css:6), which is render-blocking and delays First Contentful Paint. This causes a flash of unstyled text (FOUT) or invisible text (FOIT) while the font loads.",
      "rationale": "@import in CSS is one of the worst ways to load fonts - it blocks CSS parsing until the font loads. Moving to <link rel='preload'> with font-display: swap allows the page to render immediately with a fallback font, then swap to the custom font when ready. This is a Core Web Vitals best practice that directly improves LCP and FCP metrics.",
      "category": "rendering",
      "impact": "high",
      "affectedAreas": [
        "assets/css/app.css",
        "base.html.twig"
      ],
      "currentMetric": "Font @import blocks CSS parsing, delays FCP by 200-500ms on typical connections",
      "expectedImprovement": "~200-400ms improvement in First Contentful Paint, eliminates render-blocking resource",
      "implementation": "1. Remove @import from app.css\n2. Add preconnect hints to base.html.twig (already present)\n3. Add <link rel='preload' as='font'> for the font file\n4. Use font-display: swap in @font-face declaration\n5. Consider self-hosting the font for better control and reduced third-party dependency",
      "tradeoffs": "Minor FOUT (flash of unstyled text) may occur as fallback font swaps to custom font, but this is preferable to blocking render",
      "estimatedEffort": "small"
    },
    {
      "id": "perf-002",
      "type": "performance_optimizations",
      "title": "Consolidate duplicate auth check API calls on page load",
      "description": "On DOMContentLoaded, the application makes two separate /moderna-api/auth/check API calls - one for wishlist store (app.js:457) and one for recentlyViewed store (app.js:464). This doubles the authentication request overhead on every page load.",
      "rationale": "Each auth check is an HTTP round-trip that adds latency. By consolidating into a single shared auth check, we reduce network requests by 50% for this operation. The auth state is the same for both stores, so a single call can update both. This also reduces server load.",
      "category": "network",
      "impact": "medium",
      "affectedAreas": [
        "assets/js/app.js"
      ],
      "currentMetric": "2 API calls to /moderna-api/auth/check on every page load",
      "expectedImprovement": "50% reduction in auth-related API calls, ~100-200ms faster Time to Interactive",
      "implementation": "1. Create a shared auth check function that caches the result\n2. Call checkAuth() once and share result between wishlist and recentlyViewed stores\n3. Consider using a shared Alpine store for auth state\n4. Example: const isAuth = await checkSharedAuth(); if(isAuth) { wishlistStore.syncWithServer(); recentlyViewedStore.syncWithServer(); }",
      "tradeoffs": "Slightly more coupling between stores, but the auth state is inherently shared",
      "estimatedEffort": "small"
    },
    {
      "id": "perf-003",
      "type": "performance_optimizations",
      "title": "Fix memory leaks in wishlist button event listeners",
      "description": "The wishlistButton component (wishlist-button.js and inline in index.html.twig) adds event listeners in init() for 'wishlist:added', 'wishlist:removed', and 'wishlist:cleared' events but never removes them. As product cards are created/destroyed (pagination, filtering, SPA navigation), orphaned listeners accumulate, causing memory leaks.",
      "rationale": "Each product card on the page creates 3 event listeners that persist even after the DOM element is removed. On a category page with 20 products, loading 5 pages creates 300 orphaned listeners. This leads to increased memory usage, slower event dispatch, and potential application crashes on long sessions.",
      "category": "memory",
      "impact": "medium",
      "affectedAreas": [
        "assets/js/wishlist-button.js",
        "index.html.twig"
      ],
      "currentMetric": "3 global event listeners per product card that are never cleaned up",
      "expectedImprovement": "Eliminates memory leak, stable memory usage during browsing sessions, prevents performance degradation over time",
      "implementation": "1. Add a destroy() method to wishlistButton component\n2. Store listener references for removal: this._listeners = {added: () => this.checkWishlist(), ...}\n3. Use x-on:remove or equivalent to call cleanup\n4. For Alpine: use $cleanup or register cleanup in destroy callback\n5. Consider using event delegation on a parent container instead of per-card listeners",
      "tradeoffs": "Requires adding cleanup logic and tracking listener references",
      "estimatedEffort": "small"
    },
    {
      "id": "perf-004",
      "type": "performance_optimizations",
      "title": "Eliminate N+1 query pattern for category images on homepage",
      "description": "The homepage (index.html.twig:115) makes a separate API call for category images inside a Twig loop: for each of the 4 categories displayed, it calls resources('/api/front/category_images', {'category.id': category.id}). This creates 4 additional API requests on every homepage load.",
      "rationale": "N+1 queries are a classic performance anti-pattern. The homepage currently makes 5+ API calls (categories, featured product, promo products, new products, plus 4 category image calls). Batch-fetching category images or including them in the initial categories API response would reduce this to 4 total calls, improving TTFB and reducing server load.",
      "category": "database",
      "impact": "high",
      "affectedAreas": [
        "index.html.twig",
        "Backend API (if configurable)"
      ],
      "currentMetric": "4+ sequential API calls for category images, 50-200ms each",
      "expectedImprovement": "~200-600ms reduction in homepage load time, 80% fewer API calls for category data",
      "implementation": "1. Option A: Modify API to include images in /api/front/categories response via 'include' parameter\n2. Option B: Create a batch endpoint: /api/front/category_images?category.id[]=1&category.id[]=2...\n3. Option C: Pre-fetch all category images in a single call before the loop\n4. Cache the results using Twig caching if available",
      "tradeoffs": "Requires backend API changes or Twig-level optimization; may need coordination with backend team",
      "estimatedEffort": "medium"
    },
    {
      "id": "perf-005",
      "type": "performance_optimizations",
      "title": "Move inline CSS from index.html.twig to compiled stylesheet",
      "description": "The homepage template (index.html.twig) contains ~390 lines of inline CSS within <style> tags (lines 201-592). This CSS is parsed on every page load and cannot be cached separately from the HTML response.",
      "rationale": "Inline CSS increases HTML payload size and bypasses browser caching. The ~15KB of inline styles are re-downloaded and re-parsed on every homepage visit. Moving these to the compiled app.css allows browser caching, reduces HTML payload, enables better minification, and improves maintainability by centralizing styles.",
      "category": "bundle_size",
      "impact": "medium",
      "affectedAreas": [
        "index.html.twig",
        "assets/css/app.css",
        "assets/css/components/ (new files)"
      ],
      "currentMetric": "~390 lines (~15KB) of inline CSS per homepage load",
      "expectedImprovement": "~15KB reduction in HTML payload, styles cached on repeat visits, better compression ratios",
      "implementation": "1. Extract homepage styles to assets/css/pages/_home.css\n2. Import in app.css: @import './pages/_home.css'\n3. Verify styles compile correctly with PostCSS/Tailwind\n4. Remove inline <style> block from index.html.twig\n5. Test slider, hero, and all homepage components",
      "tradeoffs": "Slightly increases initial CSS bundle size, but benefits outweigh costs due to caching",
      "estimatedEffort": "small"
    }
  ],
  "metadata": {
    "totalBundleSize": "Estimated ~250-400KB uncompressed (Alpine.js + Stimulus + core-js + app code)",
    "largestDependencies": [
      "core-js (~150KB)",
      "alpinejs (~40KB)",
      "@hotwired/stimulus (~25KB)",
      "tailwindcss (CSS output varies)"
    ],
    "filesAnalyzed": 25,
    "potentialSavings": "~500-800ms page load improvement, ~15KB HTML reduction, memory leak elimination",
    "criticalPathBottlenecks": [
      "Google Fonts @import (render-blocking)",
      "Multiple sequential API calls",
      "Inline CSS not cacheable"
    ],
    "generatedAt": "2026-01-09T17:25:00Z"
  }
}
