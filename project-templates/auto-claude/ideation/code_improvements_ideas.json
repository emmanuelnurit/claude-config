{
  "code_improvements": [
    {
      "id": "ci-001",
      "type": "code_improvements",
      "title": "Add Live Search Results to SearchModal",
      "description": "Enhance the existing SearchModal component to display real-time product search results as the user types, instead of just showing 'Press Enter to see all results' placeholder. Results would appear in a dropdown with product images, titles, and prices.",
      "rationale": "The SearchModal.html.twig already exists with Alpine.js store integration ($store.search). The CartItemsController API pattern is established for fetching product data via JSON. The ProductCard TwigComponent provides the product display pattern. Only the API endpoint and frontend integration are missing.",
      "builds_upon": ["SearchModal component", "API Controller pattern (CartItemsController)", "Alpine.js store pattern"],
      "estimated_effort": "small",
      "affected_files": [
        "src/Api/SearchController.php",
        "components/Layout/SearchModal.html.twig",
        "assets/js/app.js"
      ],
      "existing_patterns": [
        "CartItemsController for JSON API responses",
        "Alpine $store.search for state management",
        "ProductQuery for product lookups"
      ],
      "implementation_approach": "Create new SearchController.php following CartItemsController pattern with a /moderna-api/search endpoint. Add x-init to SearchModal to watch $store.search.query with debounce, fetching results when query.length > 2. Display results using existing product card styling patterns from ProductCard component.",
      "status": "draft",
      "created_at": "2026-01-09T14:25:00.000Z"
    },
    {
      "id": "ci-002",
      "type": "code_improvements",
      "title": "Add Product Comparison Feature",
      "description": "Create a product comparison system allowing customers to compare multiple products side-by-side. Includes add/remove to comparison functionality on product cards and a comparison drawer/page showing product attributes.",
      "rationale": "WishlistController already implements the exact pattern needed: add/remove/sync/clear operations with localStorage sync for anonymous users and database persistence for authenticated users. The wishlist-button.js Alpine component provides the toggle button pattern. The CartDrawer component provides the slide-out panel pattern.",
      "builds_upon": ["WishlistController API structure", "wishlist-button.js Alpine component", "CartDrawer slide-out panel"],
      "estimated_effort": "medium",
      "affected_files": [
        "src/Api/ComparisonController.php",
        "assets/js/comparison-button.js",
        "components/Layout/ComparisonDrawer.html.twig",
        "src/UiComponents/Product/ProductCard.html.twig"
      ],
      "existing_patterns": [
        "WishlistController for CRUD operations",
        "wishlistButton() Alpine factory function",
        "Alpine.store pattern for comparison state",
        "CartDrawer for slide-out UI"
      ],
      "implementation_approach": "Copy WishlistController to ComparisonController, adapting customer_wishlist table to customer_comparison. Create comparison-button.js copying wishlist-button.js pattern. Add Alpine.store('comparison') following $store.wishlist pattern. Create ComparisonDrawer.html.twig based on CartDrawer structure showing products in columns.",
      "status": "draft",
      "created_at": "2026-01-09T14:25:00.000Z"
    },
    {
      "id": "ci-003",
      "type": "code_improvements",
      "title": "Create Button TwigComponent",
      "description": "Create a reusable Button TwigComponent following the Badge component pattern, providing consistent button styling with variants (primary, secondary, outline, ghost), sizes (sm, md, lg), and states (loading, disabled).",
      "rationale": "The Badge TwigComponent demonstrates the exact pattern: PHP class with variant properties and getCssClass() method, paired with Twig template. Currently buttons are styled inconsistently across templates. The Badge pattern of TYPE_COLOR_MAP and STATUS_COLOR_MAP provides the model for button variants.",
      "builds_upon": ["Badge TwigComponent", "Tailwind CSS button classes"],
      "estimated_effort": "small",
      "affected_files": [
        "src/UiComponents/Common/Button/Button.php",
        "src/UiComponents/Common/Button/Button.html.twig",
        "assets/css/components/_button.css"
      ],
      "existing_patterns": [
        "Badge.php with variant properties and getCssClass()",
        "#[AsTwigComponent] registration",
        "#[ExposeInTemplate] for public properties",
        "BEM CSS naming in _badge.css"
      ],
      "implementation_approach": "Create Button.php with $variant, $size, $disabled, $loading properties following Badge.php structure. Implement getVariantClass(), getSizeClass(), getStateClass() methods. Create Button.html.twig using <button> with dynamic classes. Add _button.css with BEM classes for variants following _badge.css pattern.",
      "status": "draft",
      "created_at": "2026-01-09T14:25:00.000Z"
    },
    {
      "id": "ci-004",
      "type": "code_improvements",
      "title": "Add Price Formatter Twig Filter",
      "description": "Create a centralized |format_price Twig filter for consistent price formatting across all templates, supporting locale-aware currency display with proper decimal separators and currency symbols.",
      "rationale": "TaxedPriceExtension already establishes the Twig extension pattern. ProductCard.php has getTaxedPriceFormatted() with number_format(value, 2, ',', ' ') . ' €' logic duplicated across templates. A centralized filter would eliminate duplication and ensure consistency.",
      "builds_upon": ["TaxedPriceExtension Twig extension", "ProductCard price formatting methods"],
      "estimated_effort": "trivial",
      "affected_files": [
        "src/Twig/PriceFormatterExtension.php"
      ],
      "existing_patterns": [
        "TaxedPriceExtension extending AbstractExtension",
        "TwigFunction registration in getFunctions()",
        "ProductCard.php number_format() usage"
      ],
      "implementation_approach": "Create PriceFormatterExtension.php extending AbstractExtension. Add getFilters() returning TwigFilter('format_price', ...). Implement formatPrice(float $price, ?string $currency = '€', ?string $locale = 'fr_FR') method using number_format with locale-appropriate separators. Register as service with autoconfigure: true.",
      "status": "draft",
      "created_at": "2026-01-09T14:25:00.000Z"
    },
    {
      "id": "ci-005",
      "type": "code_improvements",
      "title": "Add Recently Viewed Products Widget",
      "description": "Create a RecentlyViewed TwigComponent to display recently viewed products on product pages and homepage, using the existing RecentlyViewedController API for data.",
      "rationale": "RecentlyViewedController already provides /sync and /track API endpoints with full product data including images. The ProductCard TwigComponent provides the product display pattern. Only the widget component connecting these is missing. Anonymous users can use localStorage, authenticated users get server sync.",
      "builds_upon": ["RecentlyViewedController API", "ProductCard TwigComponent", "Alpine.js localStorage pattern from wishlist"],
      "estimated_effort": "small",
      "affected_files": [
        "src/UiComponents/Product/RecentlyViewed.php",
        "src/UiComponents/Product/RecentlyViewed.html.twig",
        "assets/js/recently-viewed-store.js"
      ],
      "existing_patterns": [
        "RecentlyViewedController for API data",
        "ProductCard for product display",
        "Alpine.store('wishlist') for localStorage + server sync",
        "Product page tracking pattern"
      ],
      "implementation_approach": "Create Alpine.store('recentlyViewed') following wishlist store pattern with localStorage persistence and server sync via /moderna-api/recently-viewed/sync. Create RecentlyViewed.php TwigComponent with $maxItems property. Template uses x-for over $store.recentlyViewed.items to render ProductCard components. Add tracking on product page load.",
      "status": "draft",
      "created_at": "2026-01-09T14:25:00.000Z"
    }
  ]
}
